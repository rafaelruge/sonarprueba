<div class="container">
  <div class="row">
    <div class="col-md-12 mt-6">
      <div class="card mt-3 mb-3 borderTable">
        <div class="col-12 d-flex justify-content-center">
          <img class="imageSobreBorde" [src]="'Test.png' | imageCdn">
        </div>
        <div class="row justify-content-center mt-4">

          <div class="col-12 titulo">{{'MODULES.GESTIONTEST.TITLE' | translate}}</div>

          <div class="col-11 col-lg-8">

            <div class="row boxBtnFilter">

              <div class="col-sm-4 boxBtnCreate form-group">

                <button class="boton btnCreate animate__animated animate__fadeIn fast" type="button"
                  (click)="openModalGestionTest(templateGestionTest, '')">{{'MODULES.GESTIONTEST.BOTONCREAR'
                  | translate}}</button>


                <button class="boton btnDuplicarLote animate__animated animate__fadeIn fast" type="button"
                  (click)="openModalLote(templateDuplicarLote, '')"
                  title="   {{'MODULES.GESTIONTEST.DUPLICARLOTE'| translate}}">
                  <i class="fas fa-cog"></i>
                </button>
              </div>

              <div class="col-sm-8 boxFilter">
                <i class="fa fa-search"></i>
                <mat-form-field class="filter">
                  <mat-label>{{'MODULES.FILTER.LABEL' | translate}}</mat-label>
                  <input matInput (keyup)="applyFilter($event)"
                    placeholder="{{'MODULES.FILTER.PLACEHOLDER' | translate}}" #input>
                </mat-form-field>
              </div>

            </div>

          </div>

          <div class="col-11 col-lg-8">
            <table mat-table [dataSource]="dataSource" class="table-responsive" matSort>
              <ng-container matColumnDef="lotmatcontrol">
                <th style="width: 400px;" mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{'MODULES.GESTIONTEST.COLUMNS.TEST' | translate}}</th>
                <td mat-cell *matCellDef="let row"><a class="vsm-link"
                    (click)="openModalDetalleGestionTest(templateDetallesGestionTest, row)"
                    style="cursor: pointer;">{{'MODULES.GESTIONTEST.DETALLES'
                    | translate}}</a></td>
              </ng-container>

              <ng-container matColumnDef="analitos">
                <th style="width: 400px;" mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{'MODULES.GESTIONTEST.COLUMNS.ANALITOS' | translate}} </th>
                <td mat-cell *matCellDef="let row">{{row.Desanalytes}}</td>
              </ng-container>

              <ng-container matColumnDef="analizador">
                <th style="width: 400px;" mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{'MODULES.GESTIONTEST.COLUMNS.ANALIZADOR' | translate}} </th>
                <td mat-cell *matCellDef="let row"> {{row.NameAnalyzer}} </td>
              </ng-container>

              <ng-container matColumnDef="active">
                <th style="width: 200px;" mat-header-cell *matHeaderCellDef>
                  {{'MODULES.GESTIONTEST.COLUMNS.ESTADO' | translate}}</th>
                <td mat-cell *matCellDef="let row">
                  <mat-slide-toggle [checked]="row.Active" (change)="actualizarGestionTest(row)"></mat-slide-toggle>
                </td>
              </ng-container>

              <ng-container matColumnDef="editar">
                <th style="width: 200px;" mat-header-cell *matHeaderCellDef>
                  {{'MODULES.GESTIONTEST.COLUMNS.EDITAR' | translate}}</th>
                <td mat-cell *matCellDef="let row">
                  <img [src]="'imagenEditar.png' | imageCdn"
                    (click)="openModalGestionTestEdit(templateGestionTestEdit, row.IdTest)" style="cursor: pointer;">
                </td>
              </ng-container>

              <ng-container matColumnDef="borrar">
                <th style="width: 200px;" mat-header-cell *matHeaderCellDef>
                  {{'MODULES.GESTIONTEST.COLUMNS.ELIMINAR' | translate}}</th>
                <td mat-cell *matCellDef="let row let i = index;">
                  <img [src]="'imagenEliminar.png' | imageCdn" (click)="eliminarGestionTest(row.IdTest)"
                    style="cursor: pointer;">
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

              <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
              </tr>
            </table>
            <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #templateGestionTest>

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeVentana()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body" style="overflow-y: scroll; height: 27rem;">

    <div class="row">

      <div class="col flex2" style="margin-top: 0px !important;">

        <img *ngIf="accionEditar" class="img" [src]="'edit.png' | imageCdn">
        <img *ngIf="!accionEditar" class="img" [src]="'crear2.png' | imageCdn">
        <h3 class="tituloModal">{{tituloAccion}}</h3>
        <div class="hr" style="width: 33% !important;"></div>

      </div>
    </div>

    <form [formGroup]="formularioTest" (ngSubmit)="crearEditarTest()" *ngIf="formularioTest">

      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idControlMaterial">
              {{'MODULES.GESTIONTEST.FORMULARIO.CONTROLMAT' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto01" formControlName="idControlMaterial" #contmatPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto01="matAutocomplete" (optionSelected)="cambiarControlMaterial(contmatPr.value)">
                <mat-option *ngFor="let option of (filteredOptionsControlMaterial | async);"
                  [value]="option.descontmat" [matTooltip]="option.descontmat | NombreControlmaterial">
                  {{option.descontmat | NombreControlmaterial}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="lotmatcontrolForm.invalid  && lotmatcontrolForm.touched && !lotmatcontrolForm.errors?.minlength && !lotmatcontrolForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idLot">{{'MODULES.GESTIONTEST.FORMULARIO.LOTE' | translate}}<span
                class="colorAsterisco"> *</span></mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto" formControlName="idLot" #lotePr01
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="seleccionarlot(lotePr01.value)">
                <mat-option *ngFor="let option of (filteredOptionsLots | async);" [value]="option.Numlot" [matTooltip]="option.Numlot | nombreLote">
                  {{option.Numlot | nombreLote}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="lotForm.invalid  && lotForm.touched && !lotForm.errors?.minlength && !lotForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">

            <mat-label class="matLabelForm" for="idheadquarters">{{'MODULES.GESTIONTEST.FORMULARIO.SEDE' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto02" formControlName="idheadquarters" #sedePr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto02="matAutocomplete" (optionSelected)="seleccionarsede(sedePr.value)">
                <mat-option *ngFor="let option of (filteredOptionsSedes | async);" [value]="option.desheadquarters" [matTooltip]="option.desheadquarters | NombreSede">

                  {{option.desheadquarters | NombreSede}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="sedeForm.invalid  && sedeForm.touched && !sedeForm.errors?.minlength && !sedeForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idanalytes">{{'MODULES.GESTIONTEST.FORMULARIO.ANALITOS' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto03" formControlName="idanalytes" #analytePr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto03="matAutocomplete" (optionSelected)="setLevel(analytePr.value)">
                <mat-option *ngFor="let option of (filteredOptionsAnalitos | async);" [value]="option.Desanalyte" [matTooltip]="option.Desanalyte | NombreAnalito">
                  {{option.Desanalyte | NombreAnalito}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idAnalytesForm.invalid  && idAnalytesForm.touched && !idAnalytesForm.errors?.minlength && !idAnalytesForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idAnalyzer">
              {{'MODULES.GESTIONTEST.FORMULARIO.ANALIZADOR' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto04" formControlName="idAnalyzer" #analyzerPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto04="matAutocomplete" (optionSelected)="seleccionaranalizadores(analyzerPr.value)">
                <mat-option *ngFor="let option of (filteredOptionsAnalizadores | async);" [value]="option.Desanalyzer" [matTooltip]="option.Desanalyzer | NombreAnalyzer">
                  {{option.Desanalyzer | NombreAnalyzer}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idAnalyzerForm.invalid  && idAnalyzerForm.touched && !idAnalyzerForm.errors?.minlength && !idAnalyzerForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idmethods">
              {{'MODULES.GESTIONTEST.FORMULARIO.METODO' | translate}}<span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto05" formControlName="idmethods" #metodoPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto05="matAutocomplete" (optionSelected)="seleccionarmetodos(metodoPr.value)">
                <mat-option *ngFor="let option of (filteredOptionsMethods | async);" [value]="option.Desmethods" [matTooltip]="option.Desmethods | NombreMetodo">
                  {{option.Desmethods | NombreMetodo}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idMethodsForm.invalid  && idMethodsForm.touched && !idMethodsForm.errors?.minlength && !idMethodsForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' | translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idreagents">{{'MODULES.GESTIONTEST.FORMULARIO.REACTIVO' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto06" formControlName="idreagents" #reagentPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto06="matAutocomplete" (optionSelected)="seleccionarreactivos(reagentPr.value)">
                <mat-option *ngFor="let option of (filteredOptionsReagents | async);" [value]="option.Desreagents" [matTooltip]="option.Desreagents | NombreReactivo">
                  {{option.Desreagents | NombreReactivo}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idregentsForm.invalid  && idregentsForm.touched && !idregentsForm.errors?.minlength && !idregentsForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' | translate}}</small>

          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idunits">
              {{'MODULES.GESTIONTEST.FORMULARIO.UNIDADMEDIDA' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto07" formControlName="idunits" #unitsPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto07="matAutocomplete" (optionSelected)="seleccionarUnidades(unitsPr.value)">
                <mat-option *ngFor="let option of (filteredOptionsUnits | async);" [value]="option.Desunits" [matTooltip]="option.Desunits | NombreUnidad">
                  {{option.Desunits | NombreUnidad}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idUnitsForm.invalid  && idUnitsForm.touched && !idUnitsForm.errors?.minlength && !idUnitsForm.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <label class="labelForm" for="decimals">{{'MODULES.GESTIONTEST.FORMULARIO.DECIMALES' |
              translate}}<span class="colorAsterisco"> *</span></label>
            <input formControlName="decimals" type="number" class="form-control"
              [ngClass]="!accionEditar ? 'styleForm' : 'styleForm2'" id="decimals">

            <small *ngIf="decimalsForm.errors?.required  && decimalsForm.touched"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
            <small *ngIf="decimalsForm.errors?.min" class="text-danger animated fadeIn">{{'MODULES.CAMPOS.MIN_0' |
              translate}}</small>

          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <label class="labelForm" for="homologation">{{'MODULES.GESTIONTEST.FORMULARIO.HOMOLOGACION' |
              translate}}</label>
            <input formControlName="homologation" type="text" class="form-control"
              [ngClass]="!accionEditar ? 'styleForm' : 'styleForm2'" id="homologation">


          </div>
        </div>
        <div class="col-sm-3 col-lg-4 form-group">
          <div role="group">
            <label class="labelForm" for="active">{{'MODULES.GESTIONTEST.FORMULARIO.ACTIVO' | translate}}</label><br>
            <mat-slide-toggle formControlName="active"></mat-slide-toggle>
          </div>
        </div>


      </div>

      <div class="form-row">
        <div class="col-12 boxBtnAceptCancel">
          <button *ngIf="desactivar" class="boton btnAceptar" type="submit">{{'MODULES.BOTONACEPTAR' |
            translate}}</button>
          <button class="botonCancelar btnCancel" type="button" (click)="closeVentana()">{{'MODULES.BOTONCANCELAR' |
            translate}}</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #templateGestionTestEdit>

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeVentana()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body" style="overflow-y: scroll;">
    <div class="row">
      <div class="col flex2" style="margin-top: 0px !important;">
        <img *ngIf="accionEditar" class="img" [src]="'edit.png' | imageCdn">
        <img *ngIf="!accionEditar" class="img" [src]="'crear2.png' | imageCdn">
        <h3 class="tituloModal">{{tituloAccion}}</h3>
        <div class="hr" style="width: 33% !important;"></div>
      </div>
    </div>

    <form [formGroup]="formularioTestEdit" (ngSubmit)="EditarTest()" *ngIf="formularioTestEdit">

      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idControlMaterial">
              {{'MODULES.GESTIONTEST.FORMULARIO.CONTROLMAT' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="auto01" formControlName="idControlMaterial" #contmatPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto01="matAutocomplete" (optionSelected)="getLots(contmatPr.value)">
                <mat-option *ngFor="let contmat of filteredOptionsControlMaterialEdit | async "
                  [value]="contmat.descontmat" [matTooltip]="contmat.descontmat">
                  {{ contmat.descontmat }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="lotmatcontrolFormEdit.invalid  && lotmatcontrolFormEdit.touched && !lotmatcontrolFormEdit.errors?.minlength && !lotmatcontrolFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |translate}}</small>
          </div>

        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idLot">{{'MODULES.GESTIONTEST.FORMULARIO.LOTE' | translate}}<span
                class="colorAsterisco"> *</span></mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autolote" formControlName="idLot" #lotesPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autolote="matAutocomplete">
                <mat-option *ngFor="let lote of filteredOptionsLotsEdit | async" [value]="lote.Numlot" [matTooltip]="lote.Numlot">
                  {{ lote.Numlot }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="lotFormEdit.invalid  && lotFormEdit.touched && !lotFormEdit.errors?.minlength && !lotFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idheadquarters">{{'MODULES.GESTIONTEST.FORMULARIO.SEDE' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autosede" formControlName="idheadquarters" #sedesPr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autosede="matAutocomplete">
                <mat-option *ngFor="let sede of filteredOptionsSedesEdit | async" [value]="sede.desheadquarters" [matTooltip]="sede.desheadquarters">
                  {{ sede.desheadquarters }}
                </mat-option>
              </mat-autocomplete>

            </mat-form-field>
            <small
              *ngIf="sedeFormEdit.invalid  && sedeForm.touched && !sedeFormEdit.errors?.minlength && !sedeFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idanalytes">{{'MODULES.GESTIONTEST.FORMULARIO.ANALITOS' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autoanalito" formControlName="idanalytes"
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autoanalito="matAutocomplete">
                <mat-option *ngFor="let analito of filteredOptionsAnalitosEdit | async" [value]="analito.desanalytes" [matTooltip]="analito.desanalytes">
                  {{ analito.desanalytes }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idAnalytesFormEdit.invalid  && idAnalytesFormEdit.touched && !idAnalytesFormEdit.errors?.minlength && !idAnalytesFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idAnalyzer">
              {{'MODULES.GESTIONTEST.FORMULARIO.ANALIZADOR' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autoanalyzer" formControlName="idAnalyzer"
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autoanalyzer="matAutocomplete">
                <mat-option *ngFor="let analyzer of filteredOptionsAnalizadoresEdit | async"
                  [value]="analyzer.nameAnalyzer" [matTooltip]="analyzer.nameAnalyzer">
                  {{ analyzer.nameAnalyzer }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idAnalyzerFormEdit.invalid  && idAnalyzerFormEdit.touched && !idAnalyzerFormEdit.errors?.minlength && !idAnalyzerFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idmethods">
              {{'MODULES.GESTIONTEST.FORMULARIO.METODO' | translate}}<span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="automet" formControlName="idmethods"
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #automet="matAutocomplete">
                <mat-option *ngFor="let met of filteredOptionsMethodsEdit | async" [value]="met.desmethods" [matTooltip]="met.desmethods">
                  {{ met.desmethods }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idMethodsFormEdit.invalid  && idMethodsFormEdit.touched && !idMethodsFormEdit.errors?.minlength && !idMethodsFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idreagents">{{'MODULES.GESTIONTEST.FORMULARIO.REACTIVO' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autoreac" formControlName="idreagents"
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autoreac="matAutocomplete">
                <mat-option *ngFor="let irr of filteredOptionsReagentsEdit | async" [value]="irr.desreagents" [matTooltip]="irr.desreagents">
                  {{ irr.desreagents }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idregentsFormEdit.invalid  && idregentsFormEdit.touched && !idregentsFormEdit.errors?.minlength && !idregentsFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <mat-label class="matLabelForm" for="idunits">
              {{'MODULES.GESTIONTEST.FORMULARIO.UNIDADMEDIDA' | translate}}
              <span class="colorAsterisco"> *</span>
            </mat-label>
            <mat-form-field class="serial-tamanio ">
              <input type="text" matInput [matAutocomplete]="autounit" formControlName="idunits"
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #autounit="matAutocomplete">
                <mat-option *ngFor="let unit of filteredOptionsUnitsEdit | async" [value]="unit.desunits" [matTooltip]="unit.desunits">
                  {{ unit.desunits }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
            <small
              *ngIf="idUnitsFormEdit.invalid  && idUnitsFormEdit.touched && !idUnitsFormEdit.errors?.minlength && !idUnitsFormEdit.errors?.maxlength"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <label class="labelForm" for="decimals">{{'MODULES.GESTIONTEST.FORMULARIO.DECIMALES' | translate}}<span class="colorAsterisco"> *</span></label>
            <input formControlName="decimals" type="number" class="form-control" [ngClass]="!accionEditar ? 'styleForm2' : 'styleForm'" id="decimals">
            <small *ngIf="decimalsFormEdit.errors?.required  && decimalsFormEdit.touched" class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' | translate}}</small>
            <small *ngIf="decimalsForm.errors?.min" class="text-danger animated fadeIn">{{'MODULES.CAMPOS.MIN_0' | translate}}</small>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <label class="labelForm" for="homologation">{{'MODULES.GESTIONTEST.FORMULARIO.HOMOLOGACION' | translate}}</label>
            <input formControlName="homologation" type="text" class="form-control" [ngClass]="!accionEditar ? 'styleForm2' : 'styleForm'" id="homologation">
          </div>
        </div>
        <div class="col-sm-3 col-lg-4 form-group">
          <div role="group">
            <label class="labelForm" for="active">{{'MODULES.GESTIONTEST.FORMULARIO.ACTIVO' | translate}}</label><br>
            <mat-slide-toggle formControlName="active"></mat-slide-toggle>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-12 boxBtnAceptCancel">
          <button  class="boton btnAceptar" type="submit">{{'MODULES.BOTONACEPTAR' |
            translate}}</button>
          <button class="botonCancelar btnCancel" type="button" (click)="closeVentana()">
            {{'MODULES.BOTONCANCELAR' | translate}}</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #templateDetallesGestionTest>

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeVentana()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row">
      <div class="col flex2">
        <img class="img" [src]="'detalles.png' | imageCdn">
        <h3 class="tituloModal">{{'MODULES.GESTIONTEST.COLUMNS.DETALLES' | translate}}</h3>
        <div class="hr"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.CONTROLMAT' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Descontmat }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.LOTE' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Numlot }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.SEDE' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Desheadquarters }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.ANALITOS' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Desanalytes }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.ANALIZADOR' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.NameAnalyzer }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.METODO' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Desmethods }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.REACTIVO' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Desreagents }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.UNIDADMEDIDA' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Desunits }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.LEVEL' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Level }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.DECIMALES' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Decimals }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.HOMOLOGACION' | translate}}</p>
        <p class="bold">{{ dataModalDetalles.Homologation }}</p>
      </div>

      <div class="col-6 col-md-4 mb-4 line">
        <p class="tit">{{'MODULES.GESTIONTEST.FORMULARIO.ACTIVO' | translate}}</p>
        <mat-slide-toggle [(ngModel)]="est" disabled></mat-slide-toggle>
      </div>
    </div>
  </div>
</ng-template>


<ng-template #templateDuplicarLote>

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="closeVentana()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body" style="overflow-y: scroll; height: auto;">
    <div class="row">
      <div class="col flex2" style="margin-top: 0px !important;">
        <img class="img" [src]="'Icono_lote.png' | imageCdn">
        <h3 class=" tituloLote">{{tituloLote}}</h3>
        <div class="hr" style="width: 33% !important;"></div>
      </div>
    </div>

    <form [formGroup]="formularioLote" *ngIf="formularioLote">

      <div class="form-row">
        <div class="col-sm-1 col-lg-1 form-group">
          <div role="group">
            <img class="imgEngranaje" [src]="'engranaje.png' | imageCdn">
          </div>
        </div>
        <div class="col-sm-2 col-lg-2 form-group">
          <div role="group">
            <mat-label class="matLabelForm">{{'MODULES.GESTIONTEST.FORMULARIO.LOTEACTUAL' | translate}}<span
                class="colorAsterisco">*</span></mat-label>
            <!-- <br> -->
            <mat-form-field class="serial-tamanio " style="width:100% !important;">
              <input type="text" matInput [matAutocomplete]="auto" formControlName="idLote" #lotePr
                style="font-family: 'Open Sans' !important;font-size: 16px;">
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="cambiarLote(lotePr.value)">
                <mat-option *ngFor="let option of (filteredOptions | async);" [value]="option.Numlot"
                  [matTooltip]="option.Numlot | nombreLote" matTooltipPosition="right">
                  {{option.Numlot | nombreLote}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
        </div>

        <div class="col-sm-1 col-lg-1 form-group" *ngIf="desactivarTest">
          <div role="group" class="sf-2">
            <button class="boton btnDuplicarLote animate__animated animate__fadeIn fast" type="button"
              style="margin-top: 65%;height: 1.8em;">
              <i class="fas fa-check" (click)="getLotsDuplicar()"></i>
            </button>
          </div>
        </div>
        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group row">
            <mat-label class="matLabelForm">{{'MODULES.GESTIONTEST.FORMULARIO.LOTENUEVO'| translate}}<span
                class="colorAsterisco">*</span></mat-label>
            <mat-form-field class="serial-tamanio-espacio nuevo" style="width:100% !important;"
              [ngClass]="desactivarTest ? 'datapicker' : ''">

              <input type="text" matInput [matAutocomplete]="autoNuevo" formControlName="LoteNuevo"
                (change)="consultar($event)" [readonly]="desactivarTest"
                style="font-family: 'Open Sans' !important;font-size: 16px;"
                [ngClass]="desactivarTest ? 'colornuevo' : ''">
              <mat-autocomplete #autoNuevo="matAutocomplete">
                <mat-option *ngFor="let option of (filteredOptionsNuevo | async)" [value]="option.Numlot"
                [matTooltip]="option.Numlot"
                  (onSelectionChange)="select($event)">
                  {{option.Numlot}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>
        </div>

        <div class="col-sm-3 col-lg-3 form-group">
          <div role="group">
            <label class="labelForm" for="expDate">{{'MODULES.GESTIONTEST.FORMULARIO.FVENCIMIENTO' | translate}}<span
                class="colorAsterisco"> *</span></label>
            <mat-form-field style="display: inherit;" [ngClass]="desactivarTest ? 'datapicker' : ''">
              <input matInput [readonly]="desactivarTest" [matDatepicker]="picker" formControlName="fVencimiento"
                class="form-control styleForm " id="expDate" autocomplete="off" (change)="changeDate()"
                style="background-image: none !important;font-size: 1rem" [min]="today">
              <mat-datepicker-toggle [disabled]="desactivarTest" matSuffix [for]="picker"
                style="color:#2edad8; width: 18px;" [ngClass]="desactivarTest ? 'colorimg' : ''">
              </mat-datepicker-toggle>
              <mat-datepicker #picker style="color:white !important"></mat-datepicker>
            </mat-form-field>
            <small *ngIf="fVencimientoForm.invalid  && fVencimientoForm.touched"
              class="text-danger animated fadeIn">{{'MODULES.CAMPOS.CAMPOREQUIRED' |
              translate}}</small>

          </div>
        </div>

        <div class="col-sm-2 col-lg-2 form-group">
          <div role="group">
            <mat-form-field class="sf-2">
              <mat-label class="matLabelForm" for="mContro">
                {{'MODULES.GESTIONTEST.FORMULARIO.MCONTROL'| translate}}
                <span class="colorAsterisco"> *</span>
              </mat-label>
              <mat-select [disabled]="desactivarTest" [ngClass]="desactivarTest ? 'colorBloqueado' : ''"
                disableOptionCentering formControlName="mContro" class="form-control styleForm"
                style="margin-top: 13.2px;">
                <mat-option value="">{{'MODULES.USUARIOS.FORMULARIO.SELECCIONE' | translate}}</mat-option>
                <mat-option *ngFor="let contmates of controlmaterialActive " [value]="contmates.idControlMaterial" [matTooltip]="contmates.idControlMaterial">
                  {{ contmates.descontmat }}
                </mat-option>
              </mat-select>

            </mat-form-field>
          </div>
        </div>
        <div class="col-sm-1 col-lg-1 form-group" *ngIf="!desactivarTest">
          <div role="group" class="sf-2">
            <button class="boton btnDuplicarLote animate__animated animate__fadeIn fast" type="button"
              style="margin-top: 65%;height: 1.8em;" [disabled]="desactivarTestCreado">
              <i class="fas fa-check" (click)="createLoteTest()"></i>
            </button>
          </div>
        </div>
        <div *ngIf="visibleDuplicar" class="form-row">
          <div class="col-sm-12 col-lg-12 form-group">
            <div role="group " class="sf-2">

              <table class="table table-striped_lote ">
                <thead>
                  <tr class="tr-borde solid">
                    <td class=" row-lote">

                      <div class="col-lg-12">
                        <div class="row">
                          <div class="col-sm-2">
                            <input [disabled]="desactivarTestCreado" class="form-check-input" name="seleccionar"
                              type="checkbox" id="testall" value="*" (click)="selectAllTest($event.checked)" />
                          </div>
                          <div class="col-sm-9 color-select">
                            Seleccionar todo
                          </div>
                          <div class="col-sm-1 " style="text-align: left !important;" *ngIf="verbtn" >
                            <button id="nodup" [disabled]="(formularioLote.get('lotes')?.value).length === 0 "  (click)="DuplicarLotes()">
                              <img  class="duplicar" [src]="'duplicar.png' | imageCdn" >
                            </button>

                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </thead>
                <tbody>
                  <tr class="tr-borde solid" *ngFor="let element of dataSourcesTabla.filteredData">
                    <td class=" row-lote">

                      <div class="col-lg-12">
                        <div class="row">
                          <div class="col-sm-2">
                            <input type="checkbox" [disabled]="desactivarTestCreado" class="form-check-input"
                              id="lote_{{element.IdTest}}"
                              (click)="AgregarLotes(element.IdTest, 'lote_'+element.IdTest )" />
                          </div>
                          <div class="col-sm-10" style="text-align: left !important;">
                            {{element.Desanalytes}}|{{element.Desheadquarters}}|{{element.Desunits}}|{{element.NameAnalyzer}}|{{element.Desmethods}}|{{element.Descontmat}}

                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="form-row">
        <div class="col-12 boxBtnAceptCancel">
          <button class="botonCancelar btnCancel" type="button" (click)="closeVentana()">{{'MODULES.BOTONCANCELAR' |
            translate}}</button>
        </div>
      </div>
    </form>
  </div>
</ng-template>
